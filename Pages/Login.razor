@page "/Login"

<PageTitle>WAF Login</PageTitle>

<script suppress-error="BL9992">
    @*
    Sending the login credentials unfortunately isn't as straight-forward
    as a <form method="POST"> if we'd like to play a custom animation
    on unsuccessful login. Fortunately, a small helper function to interpret
    the response is all we need.
    *@
    async function login() {
        var form   = document.querySelector('form#login');
        var inputs = Array.from(form.getElementsByTagName('input'));

        var formData = new FormData(form);

        var resp = await fetch('/Login', {
            method: 'POST',
            body: formData
        });

        if(resp.ok) {
            window.location.href = '/Admin/Logs';
        } else if(resp.status == 403) {
            cycleClass(form, 'bad-login');
            inputs.filter(i => i.type != 'submit').forEach(e => e.value = null);
            inputs[0].focus();
        } else {
            alert('Unknown error while attempting to login!');
        }
    }
</script>

<h2>Login</h2>

<form id="login" action="javascript:login();">
    <input type="text" name="username" placeholder="Username" required>
    <input type="password" name="password" placeholder="Password" required>
    <input type="submit" value="Login">
</form>
